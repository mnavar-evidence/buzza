openapi: 3.1.0
info:
  title: Buzza API
  version: "0.1.0"
  description: |
    Mockable API for the Buzza ChatGPT integration. Supports demo-mode
    insights as well as authenticated Clover merchant access once OAuth is
    completed.
servers:
  - url: https://api.marketbuzz.ai
    description: Production
  - url: https://sandbox.marketbuzz.ai
    description: Sandbox / demo mode
security:
  - oauth2: [read:sales, read:customers, read:insights]
paths:
  /insights/sales:
    get:
      summary: Retrieve summarized sales metrics for the current period.
      description: |
        Returns aggregated sales stats, comparisons, and flags. Supports
        demo-mode when `demo_mode=true` is supplied.
      operationId: listSalesInsights
      parameters:
        - in: query
          name: timeframe
          schema:
            type: string
            enum: [today, yesterday, seven_days, thirty_days, custom]
          description: Reporting window. Defaults to `seven_days`.
        - in: query
          name: demo_mode
          schema:
            type: boolean
          description: Enable synthetic insights for prospective merchants.
      responses:
        "200":
          description: Sales insight payload.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SalesInsight'
              examples:
                demo:
                  summary: Demo sales insight
                  value:
                    merchant_id: demo-cafe-001
                    timeframe: seven_days
                    gross_sales: 18250.43
                    net_sales: 17100.12
                    avg_ticket: 18.34
                    change_vs_prior: -0.08
                    top_flags:
                      - type: negative_trend
                        message: Monday lunch revenue fell 15% week-over-week.
                      - type: opportunity
                        message: Upsell pastries after 3pm to lift ticket size.
        "401":
          $ref: '#/components/responses/UnauthorizedError'
  /insights/products:
    get:
      summary: Top and declining products with recommendations.
      operationId: listProductInsights
      parameters:
        - in: query
          name: timeframe
          schema:
            type: string
            default: thirty_days
        - in: query
          name: demo_mode
          schema:
            type: boolean
      responses:
        "200":
          description: Product level insight list.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductInsightResponse'
              examples:
                demo:
                  value:
                    merchant_id: demo-cafe-001
                    timeframe: thirty_days
                    winners:
                      - product_id: latte-12oz
                        name: Vanilla Oat Latte
                        share_of_sales: 0.18
                        lift_vs_average: 0.12
                        recommended_action: Promote during morning rush with SMS.
                    underperformers:
                      - product_id: breakfast-burrito
                        name: Sunrise Burrito
                        share_of_sales: 0.04
                        change_vs_prior: -0.22
                        recommended_action: Bundle with drip coffee at $9.99.
        "401":
          $ref: '#/components/responses/UnauthorizedError'
  /insights/trends:
    get:
      summary: Detect emerging anomalies and demand shifts.
      operationId: listTrendInsights
      parameters:
        - in: query
          name: horizon
          schema:
            type: string
            enum: [short_term, medium_term]
            default: short_term
        - in: query
          name: demo_mode
          schema:
            type: boolean
      responses:
        "200":
          description: Trend spotting results.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrendInsightResponse'
              examples:
                demo:
                  value:
                    merchant_id: demo-cafe-001
                    insights:
                      - id: trend-20240915-evening
                        category: foot_traffic
                        severity: medium
                        message: Evening walk-ins down 12% for two consecutive weeks.
                        suggested_prompts:
                          - "Buzza, should I close early today?"
                          - "Can you ask Buzza to draft a lunch promo?"
        "401":
          $ref: '#/components/responses/UnauthorizedError'
  /campaigns/preview:
    post:
      summary: Generate a ready-to-send campaign preview.
      description: |
        Creates a draft SMS or email using recommended segmentation and
        messaging. Requires write permissions.
      operationId: createCampaignPreview
      security:
        - oauth2: [write:campaigns]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CampaignPreviewRequest'
            examples:
              sms_demo:
                value:
                  channel: sms
                  goal: reactivate_dormant_customers
                  tone: upbeat
                  offer: "Buy 1 get 1 50% off on fall lattes"
                  audience_filter:
                    last_visit_before_days: 45
      responses:
        "200":
          description: Campaign draft details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignPreviewResponse'
              examples:
                demo:
                  value:
                    preview_id: prev-abc123
                    channel: sms
                    recommended_send_time: "2024-09-20T15:00:00-05:00"
                    audience_size: 132
                    message: "Hey Buzza Cafe fam! Miss you. Swing by today and get your second latte 50% off. Show this text."
        "400":
          description: Invalid request payload.
        "401":
          $ref: '#/components/responses/UnauthorizedError'
components:
  securitySchemes:
    oauth2:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: https://marketbuzz.ai/oauth/authorize
          tokenUrl: https://marketbuzz.ai/oauth/token
          scopes:
            read:sales: Access sales performance metrics.
            read:customers: Access customer segmentation data.
            read:insights: Access generated insights and recommendations.
            write:campaigns: Create marketing campaign drafts and nudges.
  responses:
    UnauthorizedError:
      description: Missing or invalid authorization.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
  schemas:
    SalesInsight:
      type: object
      properties:
        merchant_id:
          type: string
        timeframe:
          type: string
        gross_sales:
          type: number
          format: float
        net_sales:
          type: number
          format: float
        avg_ticket:
          type: number
          format: float
        change_vs_prior:
          type: number
          description: Percent change expressed as a decimal.
        top_flags:
          type: array
          items:
            $ref: '#/components/schemas/InsightFlag'
    InsightFlag:
      type: object
      properties:
        type:
          type: string
          enum: [opportunity, negative_trend, alert]
        message:
          type: string
    ProductInsightResponse:
      type: object
      properties:
        merchant_id:
          type: string
        timeframe:
          type: string
        winners:
          type: array
          items:
            $ref: '#/components/schemas/ProductInsight'
        underperformers:
          type: array
          items:
            $ref: '#/components/schemas/ProductInsight'
    ProductInsight:
      type: object
      properties:
        product_id:
          type: string
        name:
          type: string
        share_of_sales:
          type: number
          format: float
        lift_vs_average:
          type: number
          format: float
        change_vs_prior:
          type: number
          format: float
        recommended_action:
          type: string
    TrendInsightResponse:
      type: object
      properties:
        merchant_id:
          type: string
        insights:
          type: array
          items:
            $ref: '#/components/schemas/TrendInsight'
    TrendInsight:
      type: object
      properties:
        id:
          type: string
        category:
          type: string
          enum: [foot_traffic, revenue, campaign, staffing]
        severity:
          type: string
          enum: [low, medium, high]
        message:
          type: string
        suggested_prompts:
          type: array
          items:
            type: string
    CampaignPreviewRequest:
      type: object
      required:
        - channel
        - goal
      properties:
        channel:
          type: string
          enum: [sms, email]
        goal:
          type: string
          enum: [reactivate_dormant_customers, boost_loyalty, drive_new_visits]
        tone:
          type: string
        offer:
          type: string
        audience_filter:
          type: object
          properties:
            last_visit_before_days:
              type: integer
            frequency_segment:
              type: string
            lifetime_value_min:
              type: number
    CampaignPreviewResponse:
      type: object
      properties:
        preview_id:
          type: string
        channel:
          type: string
        recommended_send_time:
          type: string
          format: date-time
        audience_size:
          type: integer
        message:
          type: string
        follow_up_prompt:
          type: string
          description: Suggested next question for the merchant.
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
